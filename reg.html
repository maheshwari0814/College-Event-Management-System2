<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event Registration - NRCM</title>
  <link rel="stylesheet" href="college.css">
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background-color: #f8f9fa;
    }

    h1 {
      color: #004085;
      text-align: center;
    }

    .form-container {
      width: 50%;
      margin: 40px auto;
      background: #fff;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      margin-bottom: 20px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    button {
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    #certificatePreview {
      display: none;
      width: 100%;
      text-align: center;
      background: linear-gradient(135deg, #e0f7fa, #ffffff);
      border: 3px solid #007bff;
      border-radius: 15px;
      padding: 40px;
      margin-top: 30px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    #downloadCertificate {
      display: none;
      background-color: #28a745;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }

    #downloadCertificate:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>
  <header>
    <h1>Event Registration Form</h1>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="event.html">Events</a></li>
        <li><a href="reg.html">Registration</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="form-container">
      <h2>Register for an Event</h2>
      <form id="eventForm">
        <label for="name">Full Name:</label>
        <input type="text" id="name" name="name" placeholder="Enter your full name" required>

        <label for="email">Email ID:</label>
        <input type="email" id="email" name="email" placeholder="Enter your email" required>

        <label for="department">Department:</label>
        <select id="department" name="department" required>
          <option value="">-- Select Department --</option>
          <option value="CSE">CSE</option>
          <option value="EEE">EEE</option>
          <option value="ECE">ECE</option>
          <option value="AIML">CSE (AI & ML)</option>
        </select>

        <label for="event">Select Event:</label>
        <select id="event" name="event" required>
          <option value="">-- Select Event --</option>
          <option value="Coding Competition">Coding Competition</option>
          <option value="Poster Presentation">Poster Presentation</option>
          <option value="Dance Competition">Dance Competition</option>
          <option value="Technical Quiz">Technical Quiz</option>
          <option value="Hackathon">Hackathon</option>
          <option value="Photography">Photography</option>
          <option value="Drama Competition">Drama Competition</option>
          <option value="Treasure Hunt">Treasure Hunt</option>
        </select>

        <button type="submit">Register</button>
      </form>

      <div id="certificatePreview">
        <h1>NRCM College</h1>
        <h2>Certificate of Participation</h2>
        <p>This is to certify that</p>
        <h2 id="certName"></h2>
        <p>from <strong id="certDept"></strong> department</p>
        <p>has successfully participated in the</p>
        <h3 id="certEvent"></h3>
        <p>organized by NRCM College.</p>
        <p>Date: <span id="certDate"></span></p>
      </div>

      <button id="downloadCertificate">Download Certificate</button>
    </section>
  </main>

  <footer>
    <center>&copy; 2025 NRCM College</center>
  </footer>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    // üî• Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDy72PKH73uVD8VE9iC-g58yHmQIYlUld8",
      authDomain: "college-event-management-cca69.firebaseapp.com",
      databaseURL: "https://college-event-management-cca69-default-rtdb.firebaseio.com/",
      projectId: "college-event-management-cca69",
      storageBucket: "college-event-management-cca69.appspot.com",
      messagingSenderId: "200279171351",
      appId: "1:200279171351:web:165da6f529e773bfd95752"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const form = document.getElementById("eventForm");
    const certPreview = document.getElementById("certificatePreview");
    const downloadBtn = document.getElementById("downloadCertificate");

    // üìù Registration submission
    form.addEventListener("submit", (e) => {
      e.preventDefault();

      const name = document.getElementById("name").value;
      const email = document.getElementById("email").value;
      const dept = document.getElementById("department").value;
      const event = document.getElementById("event").value;
      const date = new Date().toLocaleDateString();

      // Store registration
      db.ref("registrations").push({ name, email, department: dept, event, date });

      // Display certificate preview
      document.getElementById("certName").innerText = name;
      document.getElementById("certDept").innerText = dept;
      document.getElementById("certEvent").innerText = event;
      document.getElementById("certDate").innerText = date;

      certPreview.style.display = "block";
      downloadBtn.style.display = "inline-block";

      alert("üéâ Registration Successful! Now you can download your certificate.");
      form.reset();
    });

    // üßæ Certificate download
    downloadBtn.addEventListener("click", async () => {
      try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ orientation: "landscape", unit: "px", format: "a4" });

        const name = document.getElementById("certName").innerText;
        const dept = document.getElementById("certDept").innerText;
        const event = document.getElementById("certEvent").innerText;
        const date = document.getElementById("certDate").innerText;

        // Draw border
        doc.setDrawColor(0, 102, 204);
        doc.setLineWidth(5);
        doc.rect(20, 20, 555, 400);

        // Header
        doc.setFont("times", "bold");
        doc.setFontSize(26);
        doc.setTextColor(0, 51, 153);
        doc.text("NARASIMHA REDDY ENGINEERING COLLEGE", 80, 80);

        // Title
        doc.setFontSize(22);
        doc.setTextColor(0, 0, 0);
        doc.text("Certificate of Participation", 200, 120);

        // Body
        doc.setFontSize(18);
        doc.text("This is to certify that", 240, 160);

        doc.setTextColor(0, 102, 204);
        doc.text(name, 260, 190);

        doc.setTextColor(50, 50, 50);
        doc.text(`from ${dept} department`, 230, 220);
        doc.text("has successfully participated in the", 210, 250);

        doc.setTextColor(0, 128, 0);
        doc.text(`"${event}"`, 250, 280);

        doc.setTextColor(50, 50, 50);
        doc.text("organized by NRCM College.", 210, 310);
        doc.text(`Date: ${date}`, 240, 340);

        doc.line(400, 370, 550, 370);
        doc.text("Event Coordinator", 430, 390);

        doc.save(`${name}_Certificate.pdf`);

        // ‚úÖ Track in Firebase that certificate was downloaded
        db.ref("certificate_downloads").push({ name, dept, event, date, downloaded: true });
        alert("‚úÖ Certificate downloaded successfully!");

      } catch (error) {
        alert("‚ö†Ô∏è Error generating certificate. Please try again.");
        console.error("Certificate Error:", error);
      }
    });
  </script>
</body>
</html>
